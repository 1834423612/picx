var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,l=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(n)for(var a of n(t))o.call(t,a)&&i(e,a,t[a]);return e},r=(e,n)=>t(e,a(n));import{E as d,a as u,b as c,c as g,d as f,e as p,f as m,g as h,h as I,i as _,j as v,k as C,l as b,m as L,n as D,o as U,p as S,q as A,r as k,s as E,t as O,u as w,v as M,w as y,x as R,y as T,z as x,A as P,B as G,C as N,D as V,F as B,G as $,H as z,I as j,J as F,K as H,L as X,M as Y,N as J,O as q,P as W,Q as K,R as Q,S as Z,T as ee,U as te,V as ae,W as ne,X as se,Y as oe,Z as ie,_ as le,$ as re,a0 as de,a1 as ue,a2 as ce,a3 as ge,a4 as fe,a5 as pe,a6 as me}from"./vendor.919b8568.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const he={},Ie=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`./${e}`)in he)return;he[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((e,t)=>{n.addEventListener("load",e),n.addEventListener("error",t)})):void 0}))).then((()=>e())):e()};const _e={state:{name:"dirImageListModule",dirImageList:(()=>{const e=localStorage.getItem("PICX_MANAGEMENT");return e?JSON.parse(e):[]})()},mutations:{},actions:{DIR_IMAGE_LIST_ADD_IMAGE({state:e,dispatch:t},a){const n=e.dirImageList.find((e=>e.dir===a.dir));n&&(n.imageList.push(a),t("DIR_IMAGE_LIST_PERSIST"))},DIR_IMAGE_LIST_ADD_IMAGE_LIST({state:e,dispatch:t},a){const n=e.dirImageList.find((e=>e.dir===a.dir));n?n.imageList=a.imageList:e.dirImageList.unshift(a),t("DIR_IMAGE_LIST_PERSIST")},DIR_IMAGE_LIST_ADD_DIR({state:e,dispatch:t},a){if(!e.dirImageList.some((e=>e.dir===a))){const n={dir:a,imageList:[]};"/"===a?e.dirImageList.unshift(n):e.dirImageList.push(n),t("DIR_IMAGE_LIST_PERSIST")}},DIR_IMAGE_LIST_REMOVE_DIR({state:e,dispatch:t},a){if(e.dirImageList.some((e=>e.dir===a))){const n=e.dirImageList.findIndex((e=>e.dir===a));e.dirImageList.splice(n,1),t("DIR_IMAGE_LIST_PERSIST")}},DIR_IMAGE_LIST_REMOVE({state:e,dispatch:t},a){if(e.dirImageList.length>0){const n=e.dirImageList.find((e=>e.dir===a.dir));if(n){const e=n.imageList.findIndex((e=>e.uuid===a.uuid));-1!==e&&(n.imageList.splice(e,1),0===n.imageList.length&&(t("DIR_IMAGE_LIST_REMOVE_DIR",n.dir),t("USER_CONFIG_INFO_REMOVE_DIR",n.dir)),t("DIR_IMAGE_LIST_PERSIST"))}}},DIR_IMAGE_LIST_PERSIST({state:e}){localStorage.setItem("PICX_MANAGEMENT",JSON.stringify(e.dirImageList))},DIR_IMAGE_LOGOUT({state:e}){e.dirImageList=[],localStorage.removeItem("PICX_MANAGEMENT")}},getters:{getDirImageList:e=>e.dirImageList}},ve={state:{curImgBase64Url:"",curImgUuid:"",list:[],uploadedNumber:0},actions:{TO_UPLOAD_IMAGE_LIST_ADD({state:e},t){e.list.unshift(t)},TO_UPLOAD_IMAGE_SET_CURRENT({state:e},{uuid:t,base64Url:a}){e.curImgUuid=t,e.curImgBase64Url=a},TO_UPLOAD_IMAGE_UPLOADED({state:e}){e.uploadedNumber+=1},TO_UPLOAD_IMAGE_LIST_REMOVE({state:e},t){if(e.list.length>0){const a=e.list.findIndex((e=>e.uuid===t));if(-1!==a&&e.list.splice(a,1),0===e.list.length)e.curImgBase64Url="",e.uploadedNumber=0;else if(e.curImgUuid===t){const t=e.list[0];e.curImgBase64Url=t.imgData.base64Url,e.curImgUuid=t.uuid}}},TO_UPLOAD_IMAGE_LIST_FAIL({state:e}){if(e.list.length>0){const t=e.list.filter((e=>100!==e.uploadStatus.progress));t.length>0&&(e.list=t,e.uploadedNumber=0,e.curImgBase64Url=t[0].imgData.base64Url)}},TO_UPLOAD_IMAGE_CLEAN_URL({state:e}){e.curImgBase64Url=""},TO_UPLOAD_IMAGE_CLEAN_LIST({state:e}){e.list=[]},TO_UPLOAD_IMAGE_CLEAN_UPLOADED_NUMBER({state:e}){e.uploadedNumber=0},TO_UPLOAD_IMAGE_LOGOUT({state:e}){e.curImgBase64Url="",e.list=[],e.uploadedNumber=0}},getters:{getToUploadImageList:e=>e.list,getToUploadImage:e=>e}},Ce={state:{uploadedImageList:(()=>{const e=sessionStorage.getItem("PICX_UPLOADED");return e?JSON.parse(e):[]})()},mutations:{},actions:{UPLOADED_LIST_ADD({state:e,dispatch:t},a){e.uploadedImageList.unshift(a),t("UPLOADED_LIST_PERSIST")},UPLOADED_LIST_REMOVE({state:e,dispatch:t},a){if(e.uploadedImageList.length>0){const n=e.uploadedImageList.findIndex((e=>e.uuid===a.uuid));-1!==n&&(e.uploadedImageList.splice(n,1),t("UPLOADED_LIST_PERSIST"))}},UPLOADED_LIST_PERSIST({state:e}){sessionStorage.setItem("PICX_UPLOADED",JSON.stringify(e.uploadedImageList))},UPLOADED_LIST_LOGOUT({state:e}){e.uploadedImageList=[],sessionStorage.removeItem("PICX_UPLOADED")}},getters:{getUploadedImageList:e=>e.uploadedImageList}};var be,Le;(Le=be||(be={})).newBranch="newBranch",Le.reposBranch="reposBranch";const De=e=>{const t=Object.prototype.toString.call(e).split(" ")[1];return t.substring(0,t.length-1).toLowerCase()},Ue=e=>{for(const t in e)switch(De(e[t])){case"object":Ue(e[t]);break;case"string":e[t]="";break;case"array":e[t]=[];break;case"number":e[t]=0;break;case"boolean":e[t]=!1}};var Se,Ae;(Ae=Se||(Se={})).autoDir="autoDir",Ae.newDir="newDir",Ae.rootDir="rootDir",Ae.reposDir="reposDir";class ke{static zerofill(e){return e<10?`0${e}`:e}static getYyyyMmDd(e=Date.now()){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate();return`${a}${this.zerofill(n)}${this.zerofill(s)}`}static formatTimestamp(e=Date.now()){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate(),o=t.getHours(),i=t.getMinutes(),l=t.getSeconds();return`${a}-${this.zerofill(n)}-${this.zerofill(s)} ${this.zerofill(o)}:${this.zerofill(i)}:${this.zerofill(l)}`}}const Ee=M({modules:{dirImageListModule:_e,toUploadImageModule:ve,uploadedImageListModule:Ce,userConfigInfoModule:{state:{userConfigInfo:(()=>{const e={token:"",owner:"",email:"",name:"",avatarUrl:"",selectedRepos:"",reposList:[],branchMode:be.reposBranch,selectedBranch:"",branchList:[],dirMode:Se.reposDir,selectedDir:"",dirList:[],loggingStatus:!1,personalSetting:{defaultHash:!0,defaultMarkdown:!1}},t=localStorage.getItem("PICX_CONFIG");if(t){const a=JSON.parse(t);for(const t in a)e[t]=a[t];return e.selectedBranch&&!e.branchList.length&&(e.branchList=[{value:e.selectedBranch,label:e.selectedBranch}]),e.dirMode===Se.autoDir&&(e.selectedDir=ke.getYyyyMmDd()),e}return e})()},actions:{SET_USER_CONFIG_INFO({state:e},t){for(const a in t)e.userConfigInfo.hasOwnProperty(a)&&(e.userConfigInfo[a]=t[a])},USER_CONFIG_INFO_ADD_DIR({state:e,dispatch:t},a){e.userConfigInfo.dirList.some((e=>e.value===a))||(e.userConfigInfo.dirList.push({label:a,value:a}),t("USER_CONFIG_INFO_PERSIST"))},USER_CONFIG_INFO_REMOVE_DIR({state:e,dispatch:t},a){const{dirList:n}=e.userConfigInfo;if(n.some((e=>e.value===a))){const e=n.findIndex((e=>e.value===a));n.splice(e,1),t("USER_CONFIG_INFO_PERSIST")}},USER_CONFIG_INFO_PERSIST({state:e}){e.userConfigInfo.selectedDir=e.userConfigInfo.selectedDir.replace(/\s+/g,"-"),e.userConfigInfo.selectedBranch=e.userConfigInfo.selectedBranch.replace(/\s+/g,"-"),localStorage.setItem("PICX_CONFIG",JSON.stringify(e.userConfigInfo))},USER_CONFIG_INFO_LOGOUT({state:e}){Ue(e.userConfigInfo),localStorage.removeItem("PICX_CONFIG")}},getters:{getUserLoggingStatus:e=>e.userConfigInfo.loggingStatus,getUserConfigInfo:e=>e.userConfigInfo}},imageViewerModule:{state:{imageViewer:{imgInfo:null,isShow:!1}},mutations:{IMAGE_VIEWER(e,{imgInfo:t,isShow:a}){e.imageViewer.imgInfo=t,e.imageViewer.isShow=a},IMAGE_VIEWER_LOGOUT(e){e.imageViewer.isShow=!1,e.imageViewer.imgInfo=null}},actions:{},getters:{getImageViewer:e=>e.imageViewer}},uploadAreaActiveModule:{state:{uploadAreaActive:!1},mutations:{CHANGE_UPLOAD_AREA_ACTIVE(e,t){e.uploadAreaActive=t},UPLOAD_AREA_ACTIVE_LOGOUT(e){e.uploadAreaActive=!1}},actions:{},getters:{getUploadAreaActive:e=>e.uploadAreaActive}},uploadSettingsModule:{state:{uploadSettings:{isSetMaxSize:!0,imageMaxSize:30720}},mutations:{UPLOAD_SETTINGS_LOGOUT(e){e.uploadSettings.isSetMaxSize=!0,e.uploadSettings.imageMaxSize=51200}},actions:{},getters:{getUploadSettings:e=>e.uploadSettings}}},state:{rootName:"root"},mutations:{},actions:{LOGOUT({dispatch:e,commit:t}){e("DIR_IMAGE_LOGOUT"),e("TO_UPLOAD_IMAGE_LOGOUT"),e("UPLOADED_LIST_LOGOUT"),e("USER_CONFIG_INFO_LOGOUT"),t("IMAGE_VIEWER_LOGOUT"),t("UPLOAD_AREA_ACTIVE_LOGOUT"),t("UPLOAD_SETTINGS_LOGOUT")}},getters:{}}),Oe=Symbol("vue-store");function we(){return y(Oe)}const Me=R.create({baseURL:"https://api.github.com",timeout:3e5});Me.defaults.headers["Content-Type"]="application/json",Me.interceptors.request.use((e=>{const t=localStorage.getItem("PICX_CONFIG");return t&&(e.headers.Authorization=`token ${JSON.parse(t).token}`),e}),(e=>Promise.reject(e))),Me.interceptors.response.use((e=>e),(e=>{if(e.response&&e.response.data){const t=e.response.status,a=e.response.data.message;T.error(`Code: ${t}, Message: ${a}`),console.error("[PicX Error]",e.response)}else T.error(`${e}`);return e.response}));var ye=(e,t)=>{for(const[a,n]of t)e[a]=n;return e};const Re=x({name:"config",setup(){const e=P(),t=we(),a=G({userConfigInfo:N((()=>t.getters.getUserConfigInfo)).value,loggingStatus:N((()=>t.getters.getUserConfigInfo)).value,loading:!1,dirLoading:!1,branchLoading:!1,getUserInfo(){this.userConfigInfo.token?(this.loading=!0,Me.defaults.headers.Authorization=`token ${this.userConfigInfo.token}`,Me.get("/user").then((e=>{console.log("[getUserInfo] ",e),e&&200===e.status?(this.saveUserInfo(e),this.getReposList(e.data.repos_url)):this.loading=!1}))):T.warning("Token 不能为空！")},saveUserInfo(e){this.userConfigInfo.loggingStatus=!0,this.userConfigInfo.owner=e.data.login,this.userConfigInfo.name=e.data.name,this.userConfigInfo.email=e.data.email,this.userConfigInfo.avatarUrl=e.data.avatar_url,this.persistUserConfigInfo()},getReposList(e){Me.get(e,{params:{type:"public",sort:"created",per_page:100}}).then((e=>{if(console.log("[getReposList] ",e),200===e.status&&e.data.length>0){this.userConfigInfo.reposList=[];for(const t of e.data)t.fork||t.private||this.userConfigInfo.reposList.push({value:t.name,label:t.name,desc:t.description});this.loading=!1,this.persistUserConfigInfo()}}))},innerSelectRepos(e){this.userConfigInfo.branchList=[],this.userConfigInfo.dirList=[],a.getBranchList(e),a.persistUserConfigInfo()},getBranchList(e){this.branchLoading=!0,Me.get(`/repos/${this.userConfigInfo.owner}/${e}/branches`).then((e=>{if(console.log("[getBranchList] ",e),e&&200===e.status){if(this.branchLoading=!1,e.data.length>0){for(const t of e.data)this.userConfigInfo.branchList.push({value:t.name,label:t.name});this.userConfigInfo.selectedBranch=this.userConfigInfo.branchList[0].value,this.userConfigInfo.branchMode=be.reposBranch,this.getDirList(this.userConfigInfo.selectedBranch)}else this.userConfigInfo.selectedBranch="master",this.userConfigInfo.branchMode=be.newBranch;this.innerDirModeChange(this.userConfigInfo.dirMode),this.persistUserConfigInfo()}}))},innerSelectBranch(e){a.getDirList(e),a.persistUserConfigInfo()},getDirList(e){this.dirLoading=!0,Me.get(`/repos/${this.userConfigInfo.owner}/${this.userConfigInfo.selectedRepos}/contents`,{params:{ref:e}}).then((e=>{if(console.log("[getDirList] ",e),e&&200===e.status&&e.data.length>0){this.userConfigInfo.dirList=[{value:"/",label:"/"}];for(const t of e.data)"dir"===t.type&&this.userConfigInfo.dirList.push({value:t.name,label:t.name});this.persistUserConfigInfo()}this.dirLoading=!1}))},innerBranchModeChange(e){const t=this.userConfigInfo.selectedBranch,a=this.userConfigInfo.branchList[0].value;switch(e){case be.newBranch:this.userConfigInfo.selectedBranch="xxx",this.userConfigInfo.dirMode=Se.newDir,this.userConfigInfo.selectedDir="xxx";break;case be.reposBranch:t!==a&&(this.userConfigInfo.selectedBranch=a,this.getDirList(a));break;default:this.userConfigInfo.selectedBranch=""}this.persistUserConfigInfo()},innerDirModeChange(e){switch(e){case Se.rootDir:this.userConfigInfo.selectedDir="/";break;case Se.autoDir:this.userConfigInfo.selectedDir=ke.getYyyyMmDd();break;case Se.newDir:this.userConfigInfo.selectedDir="xxx";break;case Se.reposDir:const{dirList:e}=this.userConfigInfo;e.length?this.userConfigInfo.selectedDir=e[0].value:this.userConfigInfo.selectedDir="";break;default:this.userConfigInfo.selectedDir="/"}this.persistUserConfigInfo()},persistUserConfigInfo(){t.dispatch("USER_CONFIG_INFO_PERSIST")},reset(){this.loading=!1,this.dirLoading=!1,t.dispatch("LOGOUT")},innerGoUpload(){const{selectedDir:t,dirMode:a}=this.userConfigInfo;let n="目录不能为空！";if(""===t){switch(a){case Se.newDir:n="请在输入框输入一个新目录！";break;case Se.reposDir:n=`请选择 ${this.userConfigInfo.selectedRepos} 仓库下的一个目录！`;break;default:n="请在输入框输入一个新目录！"}T.warning(n)}else e.push("/upload")}});return V((()=>a.loggingStatus),(e=>{e||(a.loading=!1,a.dirLoading=!1)})),r(l({},B(a)),{branchModeChange:e=>{a.innerBranchModeChange(e)},dirModeChange:e=>{a.innerDirModeChange(e)},selectRepos:e=>{a.innerSelectRepos(e)},selectBranch:e=>{a.innerSelectBranch(e)},createBranch:()=>{},goUpload:()=>{a.innerGoUpload()}})}}),Te={class:"page-container config-page-container"},xe=Z(" 确认 Token "),Pe=Z("新建目录"),Ge=Z("根目录"),Ne=Z("自动目录"),Ve=Z(" 重置 "),Be=Z(" 完成配置 ");var $e,ze,je=ye(Re,[["render",function(e,t,a,n,s,o){const i=$("el-input"),l=$("el-form-item"),r=$("el-button"),d=$("el-form"),u=$("el-option"),c=$("el-select"),g=$("el-radio"),f=$("el-tooltip"),p=$("el-radio-group"),m=z("loading");return j(),F("div",Te,[H(d,{"label-width":"70px","label-position":"right",class:"config-form"},{default:X((()=>[H(l,{label:"Token"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.token,"onUpdate:modelValue":t[0]||(t[0]=t=>e.userConfigInfo.token=t),clearable:"",autofocus:!e.userConfigInfo.token},null,8,["modelValue","autofocus"])])),_:1}),H(l,{class:"operation"},{default:X((()=>[H(r,{plain:"",size:"small",type:"primary","native-type":"submit",onClick:t[1]||(t[1]=Y((t=>e.getUserInfo()),["prevent"]))},{default:X((()=>[xe])),_:1})])),_:1})])),_:1}),e.userConfigInfo.token?J((j(),q(d,{key:0,"label-width":"70px","label-position":"right","element-loading-text":"加载中..."},{default:X((()=>[e.userConfigInfo.owner?(j(),q(l,{key:0,label:"用户名"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.owner,"onUpdate:modelValue":t[2]||(t[2]=t=>e.userConfigInfo.owner=t),readonly:""},null,8,["modelValue"])])),_:1})):W("",!0),e.userConfigInfo.email?(j(),q(l,{key:1,label:"邮箱"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.email,"onUpdate:modelValue":t[3]||(t[3]=t=>e.userConfigInfo.email=t),readonly:""},null,8,["modelValue"])])),_:1})):W("",!0),e.userConfigInfo.reposList.length?(j(),q(l,{key:2,label:"选择仓库"},{default:X((()=>[H(c,{modelValue:e.userConfigInfo.selectedRepos,"onUpdate:modelValue":t[4]||(t[4]=t=>e.userConfigInfo.selectedRepos=t),filterable:"",style:{width:"100%"},placeholder:"请选择图床仓库...",onChange:e.selectRepos},{default:X((()=>[(j(!0),F(K,null,Q(e.userConfigInfo.reposList,((e,t)=>(j(),q(u,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):W("",!0)])),_:1},512)),[[m,e.loading]]):W("",!0),e.userConfigInfo.selectedRepos&&e.userConfigInfo.branchList.length?J((j(),q(d,{key:1,"label-width":"70px","label-position":"right","element-loading-text":"加载中..."},{default:X((()=>[(e.userConfigInfo.selectedRepos,W("",!0)),e.userConfigInfo.branchList.length>1&&"reposBranch"===e.userConfigInfo.branchMode?(j(),q(l,{key:1,label:"选择分支"},{default:X((()=>[H(c,{modelValue:e.userConfigInfo.selectedBranch,"onUpdate:modelValue":t[6]||(t[6]=t=>e.userConfigInfo.selectedBranch=t),filterable:"",style:{width:"100%"},placeholder:"请选择分支...",onChange:e.selectBranch},{default:X((()=>[(j(!0),F(K,null,Q(e.userConfigInfo.branchList,((e,t)=>(j(),q(u,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):W("",!0),"newBranch"===e.userConfigInfo.branchMode?(j(),q(l,{key:2,label:"新建分支"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.selectedBranch,"onUpdate:modelValue":t[7]||(t[7]=t=>e.userConfigInfo.selectedBranch=t),onInput:t[8]||(t[8]=t=>e.persistUserConfigInfo()),clearable:"",placeholder:"请输入新建的分支..."},null,8,["modelValue"])])),_:1})):W("",!0)])),_:1},512)),[[m,e.branchLoading]]):W("",!0),e.userConfigInfo.selectedBranch?J((j(),q(d,{key:2,"label-width":"70px","label-position":"right","element-loading-text":"加载中..."},{default:X((()=>[e.userConfigInfo.selectedBranch?(j(),q(l,{key:0,label:"目录方式"},{default:X((()=>[H(p,{modelValue:e.userConfigInfo.dirMode,"onUpdate:modelValue":t[9]||(t[9]=t=>e.userConfigInfo.dirMode=t),onChange:e.dirModeChange},{default:X((()=>[H(f,{content:"手动输入一个新目录",placement:"top",offset:-1},{default:X((()=>[H(g,{label:"newDir"},{default:X((()=>[Pe])),_:1})])),_:1}),H(f,{content:"图片存储在 "+e.userConfigInfo.selectedBranch+" 分支的根目录下",placement:"top",offset:-1},{default:X((()=>[H(g,{label:"rootDir"},{default:X((()=>[Ge])),_:1})])),_:1},8,["content"]),H(f,{content:"根据日期自动创建格式 YYYYMMDD 的目录",placement:"top",offset:-1},{default:X((()=>[H(g,{label:"autoDir"},{default:X((()=>[Ne])),_:1})])),_:1}),e.userConfigInfo.dirList.length&&"newBranch"!==e.userConfigInfo.branchMode?(j(),q(f,{key:0,content:"选择 "+e.userConfigInfo.selectedBranch+" 分支下的一个目录",placement:"top",offset:-1},{default:X((()=>[H(g,{label:"reposDir"},{default:X((()=>[Z(" 选择 "+ee(e.userConfigInfo.selectedRepos)+" 仓库目录 ",1)])),_:1})])),_:1},8,["content"])):W("",!0)])),_:1},8,["modelValue","onChange"])])),_:1})):W("",!0),"autoDir"===e.userConfigInfo.dirMode?(j(),q(l,{key:1,label:"自动目录"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.selectedDir,"onUpdate:modelValue":t[10]||(t[10]=t=>e.userConfigInfo.selectedDir=t),readonly:""},null,8,["modelValue"])])),_:1})):W("",!0),"rootDir"===e.userConfigInfo.dirMode?(j(),q(l,{key:2,label:"根目录"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.selectedDir,"onUpdate:modelValue":t[11]||(t[11]=t=>e.userConfigInfo.selectedDir=t),readonly:""},null,8,["modelValue"])])),_:1})):W("",!0),"newDir"===e.userConfigInfo.dirMode?(j(),q(l,{key:3,label:"新建目录"},{default:X((()=>[H(i,{modelValue:e.userConfigInfo.selectedDir,"onUpdate:modelValue":t[12]||(t[12]=t=>e.userConfigInfo.selectedDir=t),onInput:t[13]||(t[13]=t=>e.persistUserConfigInfo()),clearable:"",placeholder:"请输入新建的目录..."},null,8,["modelValue"])])),_:1})):W("",!0),e.userConfigInfo.dirList.length&&"reposDir"===e.userConfigInfo.dirMode&&"newBranch"!==e.userConfigInfo.branchMode?(j(),q(l,{key:4,label:"选择目录"},{default:X((()=>[H(c,{modelValue:e.userConfigInfo.selectedDir,"onUpdate:modelValue":t[14]||(t[14]=t=>e.userConfigInfo.selectedDir=t),filterable:"",style:{width:"100%"},placeholder:"请选择目录...",onChange:e.persistUserConfigInfo},{default:X((()=>[(j(!0),F(K,null,Q(e.userConfigInfo.dirList,(e=>(j(),q(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):W("",!0)])),_:1},512)),[[m,e.dirLoading]]):W("",!0),H(d,{"label-width":"70px"},{default:X((()=>[H(l,{class:"operation"},{default:X((()=>[e.userConfigInfo.owner?(j(),q(r,{key:0,plain:"",size:"small",onClick:t[15]||(t[15]=t=>e.reset())},{default:X((()=>[Ve])),_:1})):W("",!0),e.userConfigInfo.selectedRepos?(j(),q(r,{key:1,plain:"",size:"small",type:"success",onClick:e.goUpload},{default:X((()=>[Be])),_:1},8,["onClick"])):W("",!0)])),_:1})])),_:1})])}],["__scopeId","data-v-745d35f2"]]);(ze=$e||($e={})).gh="gh",ze.md_gh="md_gh",ze.cdn="cdn",ze.md_cdn="md_cdn";const Fe=e=>(ie("data-v-95888f3e"),e=e(),le(),e),He={class:"copy-external-link-box"},Xe={key:0,t:"1631782798077",class:"markdown-icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2861",width:"26",height:"26"},Ye=[Fe((()=>se("path",{d:"M92 192C42.24 192 0 232.128 0 282.016v459.968C0 791.904 42.24 832 92 832h840C981.76 832 1024 791.872 1024 741.984V282.016C1024 232.16 981.76 192 932 192z m0 64h840c16.512 0 28 12.256 28 26.016v459.968c0 13.76-11.52 26.016-28 26.016H92C75.488 768 64 755.744 64 741.984V282.016c0-13.76 11.52-25.984 28-25.984zM160 352v320h96v-212.992l96 127.008 96-127.04V672h96V352h-96l-96 128-96-128z m544 0v160h-96l144 160 144-160h-96v-160z","p-id":"2862",fill:"#808080"},null,-1)))],Je={key:1,t:"1631784688556",class:"markdown-icon",viewBox:"0 0 1280 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3242",width:"26",height:"26"},qe=[Fe((()=>se("path",{d:"M1187.6 118.2H92.4C41.4 118.2 0 159.6 0 210.4v603c0 51 41.4 92.4 92.4 92.4h1095.4c51 0 92.4-41.4 92.2-92.2V210.4c0-50.8-41.4-92.2-92.4-92.2zM677 721.2H554v-240l-123 153.8-123-153.8v240H184.6V302.8h123l123 153.8 123-153.8h123v418.4z m270.6 6.2L763 512H886V302.8h123V512H1132z","p-id":"3243",fill:"#3c3c3c"},null,-1)))],We={class:"btn-box"};var Ke=ye(x({props:{imgObj:{type:Object,default:()=>{}}},setup(e){const t=e,a=N((()=>Ee.getters.getUserConfigInfo)),n=te(t.imgObj),s=$e;function o(e){let t="",a="";const s=n.value.is_transform_md;switch(e){case $e.gh:s?(t=n.value.md_gh_url,a="Markdown 格式的 GitHub"):(t=n.value.github_url,a="GitHub");break;case $e.cdn:s?(t=n.value.md_cdn_url,a="Markdown 格式的 CDN"):(t=n.value.cdn_url,a="CDN")}let o=document.querySelector(".temp-external-link");o||(o=document.createElement("textarea"),o.setAttribute("class","temp-external-link"),o.style.position="absolute",o.style.top="-99999px",o.style.left="-99999px",document.body.appendChild(o)),o.value=t,o.select(),document.execCommand("copy"),T.success(`${a} 外链复制成功！`)}return ae((()=>{n.value=t.imgObj})),ne((()=>{n.value.is_transform_md=a.value.personalSetting.defaultMarkdown})),(e,t)=>{const a=$("el-tooltip");return j(),F("div",He,[se("div",null,[H(a,{content:n.value.is_transform_md?"点击转换普通外链":"点击转换 Markdown 格式外链",placement:"top"},{default:X((()=>[se("div",{class:"markdown-icon-box flex-center",onClick:t[0]||(t[0]=e=>n.value.is_transform_md=!n.value.is_transform_md)},[n.value.is_transform_md?W("",!0):(j(),F("svg",Xe,Ye)),n.value.is_transform_md?(j(),F("svg",Je,qe)):W("",!0)])])),_:1},8,["content"])]),se("div",We,[H(a,{content:"点击复制 GitHub 外链",placement:"top"},{default:X((()=>[se("span",{class:"btn-item copy-url github flex-center",onClick:t[1]||(t[1]=e=>o(oe(s).gh))}," GitHub ")])),_:1}),H(a,{content:"点击复制 CDN 外链",placement:"top"},{default:X((()=>[se("span",{class:"btn-item copy-url cdn flex-center",onClick:t[2]||(t[2]=e=>o(oe(s).cdn))}," CDN ")])),_:1})])])}}}),[["__scopeId","data-v-95888f3e"]]);const Qe=e=>(ie("data-v-7d000024"),e=e(),le(),e),Ze={class:"image-box"},et=["src"],tt={class:"info-box"},at={class:"image-info"},nt={class:"filename"},st={class:"image-operation"},ot={class:"operation-box"},it=[Qe((()=>se("i",{class:"el-icon-full-screen"},null,-1)))],lt=[Qe((()=>se("i",{class:"el-icon-delete"},null,-1)))];var rt=ye(x({props:{listing:{type:Boolean,default:!1},imageObj:{type:Object,default:()=>{}},isUploaded:{type:Boolean,default:!1}},setup(e){const t=we(),a=N((()=>t.getters.getUserConfigInfo)),n=te(!1),s=e=>{ue.confirm(`此操作将会永久删除图片 ${e.name} ？`,"删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",iconClass:"el-icon-warning"}).then((()=>{(e=>{e.deleting=!0;const{owner:n,selectedRepos:s}=a.value;Me.delete(`/repos/${n}/${s}/contents/${e.path}`,{data:{owner:n,repo:s,path:e.path,message:"delete picture via PicX(https://github.com/XPoet/picx)",sha:e.sha}}).then((a=>{console.log("[deleteImage] ",a),a&&200===a.status?(e.deleting=!1,T.success("删除成功！"),t.dispatch("UPLOADED_LIST_REMOVE",e),t.dispatch("DIR_IMAGE_LIST_REMOVE",e)):e.deleting=!1}))})(e)})).catch((()=>{console.log("取消删除")}))},o=e=>{t.commit("IMAGE_VIEWER",{isShow:!0,imgInfo:{name:e.name,size:e.size,lastModified:e.lastModified,url:e.cdn_url}})};return(t,a)=>{const i=$("el-tooltip"),l=z("loading");return J((j(),F("div",{class:de(["image-card",{listing:e.listing}]),"element-loading-text":"删除中...","element-loading-background":"rgba(0, 0, 0, 0.6)",onMouseenter:a[3]||(a[3]=e=>n.value=!0),onMouseleave:a[4]||(a[4]=e=>n.value=!1)},[se("div",Ze,[se("img",{src:e.imageObj.cdn_url,onClick:a[0]||(a[0]=t=>o(e.imageObj))},null,8,et)]),se("div",tt,[se("div",at,[se("div",nt,ee(e.imageObj.name),1),se("div",st,[H(Ke,{"img-obj":e.imageObj},null,8,["img-obj"])])])]),J(se("div",ot,[H(i,{content:"查看大图",placement:"top"},{default:X((()=>[se("div",{class:"btn",onClick:a[1]||(a[1]=t=>o(e.imageObj))},it)])),_:1}),H(i,{content:"删除图片",placement:"top"},{default:X((()=>[se("div",{class:"btn",onClick:a[2]||(a[2]=t=>s(e.imageObj))},lt)])),_:1})],512),[[re,n.value]])],34)),[[l,e.imageObj.deleting]])}}}),[["__scopeId","data-v-7d000024"]]);const dt=()=>Number(Math.random().toString().substr(2,5)+Date.now()).toString(36),ut=e=>{const t=e.lastIndexOf("."),a=e.substr(0,t).trim().replace(/\s+/g,"-"),n=e.substr(t+1,e.length);return{name:a,hash:dt(),suffix:n}},ct=e=>{const t=e.indexOf(".");return e.substr(0,t)},gt=e=>/(png|jpg|gif|jpeg|webp|svg\+xml)$/.test(e),ft=e=>Number((e/1024).toFixed(2));var pt,mt;(mt=pt||(pt={})).uploaded="uploaded",mt.allUploaded="allUploaded",mt.uploadFail="uploadFail";const ht=(e,t,a)=>{const n=`https://cdn.jsdelivr.net/gh/${a.owner}/${a.selectedRepos}@${a.selectedBranch}/${t.path}`,s=decodeURI(t.download_url);switch(e){case $e.gh:return s;case $e.md_gh:return`![${ct(t.name)}](${s})`;case $e.cdn:return n;case $e.md_cdn:return`![${ct(t.name)}](${n})`}};const It=x({name:"selected-info-bar",setup(e,t){const a=we();return{userConfigInfo:N((()=>a.getters.getUserConfigInfo)),dirChange:e=>{a.dispatch("USER_CONFIG_INFO_PERSIST"),t.emit("selected-dir-change",e)}}}}),_t={key:0,class:"selected-info-bar-box"},vt={class:"info-item"},Ct=Z(" 仓库："),bt={key:0,class:"info-item"},Lt=Z(" 分支："),Dt={key:1,class:"info-item"},Ut=Z(" 目录： ");var St=ye(It,[["render",function(e,t,a,n,s,o){const i=$("el-tag"),l=$("el-option"),r=$("el-select");return e.userConfigInfo.selectedRepos?(j(),F("div",_t,[se("span",vt,[Ct,H(i,{size:"mini"},{default:X((()=>[Z(ee(e.userConfigInfo.selectedRepos),1)])),_:1})]),e.userConfigInfo.selectedBranch?(j(),F("span",bt,[Lt,H(i,{size:"mini"},{default:X((()=>[Z(ee(e.userConfigInfo.selectedBranch),1)])),_:1})])):W("",!0),e.userConfigInfo.selectedDir?(j(),F("span",Dt,[Ut,H(r,{modelValue:e.userConfigInfo.selectedDir,"onUpdate:modelValue":t[0]||(t[0]=t=>e.userConfigInfo.selectedDir=t),placeholder:"请选择",size:"mini",onChange:e.dirChange},{default:X((()=>[(j(!0),F(K,null,Q(e.userConfigInfo.dirList,((e,t)=>(j(),q(l,{key:t,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])):W("",!0)])):W("",!0)}],["__scopeId","data-v-e46f6f06"]]);const At=x({name:"to-upload-image-card",components:{copyExternalLink:Ke,selectedInfoBar:St},props:{loadingAllImage:{type:Boolean,default:!1}},setup(){const e=we(),t=G({isShowDialog:!1,curImgInfo:{size:""},userConfigInfo:N((()=>e.getters.getUserConfigInfo)).value,toUploadImage:N((()=>e.getters.getToUploadImage)).value,hashRename(e,t){t.filename.now=e?`${t.filename.name}.${t.filename.hash}.${t.filename.suffix}`:`${t.filename.name}.${t.filename.suffix}`},rename(e,t){t.filename.name=e?t.filename.newName.trim().replace(/\s+/g,"-"):t.filename.initName,t.filename.isHashRename?t.filename.now=`${t.filename.name}.${t.filename.hash}.${t.filename.suffix}`:t.filename.now=`${t.filename.name}.${t.filename.suffix}`},getFileSize:e=>`${ft(e)} KB`,formatLastModified:e=>ke.formatTimestamp(e),async uploadImage_all(e){const t=this.toUploadImage.uploadedNumber;return t>=this.toUploadImage.list.length?pt.uploaded:!0===await this.uploadImage_single(e,this.toUploadImage.list[t])?t<this.toUploadImage.list.length?(await this.uploadImage_all(e),pt.allUploaded):pt.uploaded:pt.uploadFail},uploadImage_single(t,a){const{selectedBranch:n,email:s,owner:o}=t;a.uploadStatus.uploading=!0;const i={message:"Upload pictures via PicX(https://github.com/XPoet/picx)",branch:n,content:a.imgData.base64Content};return s&&(i.committer={name:o,email:s}),new Promise(((n,s)=>{Me.put(((e,t)=>{let a="";return"/"!==e.selectedDir&&(a=`${e.selectedDir}/`),`/repos/${e.owner}/${e.selectedRepos}/contents/${a}${t}`})(t,a.filename.now),i).then((s=>{s&&201===s.status?(this.uploadedHandle(s,a,t),e.dispatch("TO_UPLOAD_IMAGE_UPLOADED",a.uuid),n(!0),T.success("上传成功！")):(a.uploadStatus.uploading=!1,n(!1),T.error("上传失败！"))})).catch((e=>{s(e)}))}))},uploadedHandle(t,a,n){a.uploadStatus.progress=100,a.uploadStatus.uploading=!1,a.externalLink.github=ht($e.gh,t.data.content,n),a.externalLink.cdn=ht($e.cdn,t.data.content,n),a.externalLink.markdown_gh=ht($e.md_gh,t.data.content,n),a.externalLink.markdown_cdn=ht($e.md_cdn,t.data.content,n);const s={uuid:a.uuid,dir:n.selectedDir,name:t.data.content.name,path:t.data.content.path,sha:t.data.content.sha,github_url:a.externalLink.github,cdn_url:a.externalLink.cdn,md_gh_url:a.externalLink.markdown_gh,md_cdn_url:a.externalLink.markdown_cdn,is_transform_md:n.personalSetting.defaultMarkdown,deleting:!1,size:a.fileInfo.size,lastModified:a.fileInfo.lastModified};a.uploadedImg=s,n.dirList.some((e=>e.value===s.dir))||(e.dispatch("USER_CONFIG_INFO_ADD_DIR",s.dir),e.dispatch("DIR_IMAGE_LIST_ADD_DIR",s.dir)),e.dispatch("UPLOADED_LIST_ADD",s),e.dispatch("DIR_IMAGE_LIST_ADD_IMAGE",s)},imageViewer(t){e.commit("IMAGE_VIEWER",{isShow:!0,imgInfo:{name:t.filename.now,size:t.fileInfo.size,lastModified:t.fileInfo.lastModified,url:t.imgData.base64Url}})}});return ne((()=>{const e=t.userConfigInfo.personalSetting.defaultHash;t.toUploadImage.list.forEach((a=>{a.filename.isHashRename=e,t.hashRename(e,a)}))})),r(l({},B(t)),{removeToUploadImage:t=>{e.dispatch("TO_UPLOAD_IMAGE_LIST_REMOVE",t.uuid)}})}}),kt={key:0,class:"to-upload-image-list-card"},Et={class:"header"},Ot={key:0},wt={key:0,class:"body"},Mt={class:"image-uploading-info-box"},yt={class:"left-image-box flex-center"},Rt=["onClick"],Tt=["src"],xt={class:"right-operation-box"},Pt={class:"top"},Gt={class:"image-name"},Nt={class:"image-info"},Vt={class:"file-size item"},Bt={class:"last-modified item"},$t={key:0,class:"bottom rename-operation"},zt={key:1,class:"bottom rename-operation"},jt={key:0,class:"el-icon-upload2"},Ft={key:1,class:"el-icon-loading"},Ht={key:2,class:"el-icon-check"},Xt=["onClick"],Yt=se("i",{class:"el-icon-delete"},null,-1);var Jt=ye(At,[["render",function(e,t,a,n,s,o){const i=$("selected-info-bar"),l=$("el-checkbox"),r=$("el-input"),d=$("copy-externalLink"),u=$("el-tooltip");return e.toUploadImage.list.length||e.userConfigInfo.selectedRepos?(j(),F("div",kt,[se("div",Et,[se("div",null,[H(i)]),se("div",null,[e.toUploadImage.list.length?(j(),F("span",Ot," 已上传："+ee(e.toUploadImage.uploadedNumber)+" / "+ee(e.toUploadImage.list.length),1)):W("",!0)])]),e.toUploadImage.list.length?(j(),F("div",wt,[se("ul",Mt,[(j(!0),F(K,null,Q(e.toUploadImage.list,((t,a)=>(j(),F("li",{class:de(["image-uploading-info-item",{disable:e.loadingAllImage}]),key:a},[se("div",yt,[se("div",{class:"image-box",onClick:a=>e.imageViewer(t)},[se("img",{src:t.imgData.base64Url},null,8,Tt)],8,Rt)]),se("div",xt,[se("div",Pt,[se("div",Gt,ee(t.filename.now),1),se("div",Nt,[se("span",Vt,ee(e.getFileSize(t.fileInfo.size)),1),se("span",Bt,ee(e.formatLastModified(t.fileInfo.lastModified)),1)])]),t.uploadStatus.uploading||100===t.uploadStatus.progress?W("",!0):(j(),F("div",$t,[H(l,{label:"哈希化",modelValue:t.filename.isHashRename,"onUpdate:modelValue":e=>t.filename.isHashRename=e,onChange:a=>e.hashRename(a,t)},null,8,["modelValue","onUpdate:modelValue","onChange"]),H(l,{label:"重命名",modelValue:t.filename.isRename,"onUpdate:modelValue":e=>t.filename.isRename=e,onChange:a=>e.rename(a,t)},null,8,["modelValue","onUpdate:modelValue","onChange"]),t.filename.isRename?(j(),q(r,{key:0,class:"rename-input",size:"mini",modelValue:t.filename.newName,"onUpdate:modelValue":e=>t.filename.newName=e,onInput:a=>e.rename(a,t),clearable:""},null,8,["modelValue","onUpdate:modelValue","onInput"])):W("",!0)])),t.uploadStatus.uploading||100!==t.uploadStatus.progress?W("",!0):(j(),F("div",zt,[H(d,{"img-obj":t.uploadedImg},null,8,["img-obj"])]))]),se("div",{class:de(["upload-status-box",{"wait-upload":!t.uploadStatus.uploading&&100!==t.uploadStatus.progress,uploading:t.uploadStatus.uploading&&100!==t.uploadStatus.progress,uploaded:!t.uploadStatus.uploading&&100===t.uploadStatus.progress}])},[t.uploadStatus.uploading||100===t.uploadStatus.progress?W("",!0):(j(),F("i",jt)),t.uploadStatus.uploading&&100!==t.uploadStatus.progress?(j(),F("i",Ft)):W("",!0),t.uploadStatus.uploading||100!==t.uploadStatus.progress?W("",!0):(j(),F("i",Ht))],2),100===t.uploadStatus.progress||t.uploadStatus.uploading?W("",!0):(j(),F("div",{key:0,class:"remove-to-upload-image",onClick:a=>e.removeToUploadImage(t)},[H(u,{effect:"dark",content:"移除",placement:"top"},{default:X((()=>[Yt])),_:1})],8,Xt))],2)))),128))])])):W("",!0)])):W("",!0)}]]);const qt=(e,t)=>e?gt(e.type)?new Promise((a=>{const n=new FileReader;n.readAsDataURL(e),n.onload=e=>{var n;const s=null==(n=e.target)?void 0:n.result,o=ft(s.length);o>=t?ue.confirm(`当前图片 ${(o/1024).toFixed(2)} M，CDN 只能加速小于 50 MB 的图片，建议使用第三方工具 TinyPNG 压缩`,"图片过大，禁止上传",{confirmButtonText:"前往 TinyPNG",cancelButtonText:"放弃上传"}).then((()=>{window.open("https://tinypng.com/")})).catch((()=>{console.log("放弃上传")})):a(s)}})):(T.error("该文件不是图片格式！"),null):null;const Wt=x({name:"upload-area",props:{imageLoading:{type:Boolean,default:!1}},setup(){const e=we(),t=G({userConfigInfo:N((()=>e.getters.getUserConfigInfo)).value,uploadAreaActive:N((()=>e.getters.getUploadAreaActive)),uploadSettings:N((()=>e.getters.getUploadSettings)).value,toUploadImage:N((()=>e.getters.getToUploadImage)).value,onSelect(t){var a;e.commit("CHANGE_UPLOAD_AREA_ACTIVE",!0);for(const e of t.target.files)null==(a=qt(e,this.uploadSettings.imageMaxSize))||a.then((t=>{this.getImage(t,e)}))},onDrop(t){var a;e.commit("CHANGE_UPLOAD_AREA_ACTIVE",!0);for(const e of t.dataTransfer.files)null==(a=qt(e,this.uploadSettings.imageMaxSize))||a.then((t=>{this.getImage(t,e)}))},async onPaste(e){const{base64:t,file:a}=await((e,t)=>e.clipboardData&&e.clipboardData.items?new Promise((a=>{var n;for(let s=0,o=e.clipboardData.items.length;s<o;s++){const o=e.clipboardData.items[s];if("file"===o.kind){const e=o.getAsFile();null==(n=qt(e,t))||n.then((t=>{a({base64:t,file:e})}))}}})):null)(e,this.uploadSettings.imageMaxSize);this.getImage(t,a)},getImage(t,a){this.toUploadImage.list.length===this.toUploadImage.uploadedNumber&&this.toUploadImage.list.length>0&&this.toUploadImage.uploadedNumber>0&&(e.dispatch("TO_UPLOAD_IMAGE_CLEAN_LIST"),e.dispatch("TO_UPLOAD_IMAGE_CLEAN_UPLOADED_NUMBER"));const n={uuid:"",uploadStatus:{progress:0,uploading:!1},imgData:{base64Content:"",base64Url:""},fileInfo:{size:0,lastModified:0},filename:{name:"",hash:"",suffix:"",now:"",initName:"",newName:"xxx",isHashRename:!0,isRename:!1},externalLink:{github:"",cdn:"",markdown_gh:"",markdown_cdn:""}};n.imgData.base64Url=t,n.imgData.base64Content=t.split(",")[1];const{name:s,hash:o,suffix:i}=ut(a.name);n.uuid=o,n.fileInfo.size=a.size,n.fileInfo.lastModified=a.lastModified,n.filename.name=s,n.filename.hash=o,n.filename.suffix=i,n.filename.now=this.userConfigInfo.personalSetting.defaultHash?`${s}.${o}.${i}`:`${s}.${i}`,n.filename.initName=s,n.filename.isHashRename=this.userConfigInfo.personalSetting.defaultHash,e.dispatch("TO_UPLOAD_IMAGE_LIST_ADD",JSON.parse(JSON.stringify(n))),e.dispatch("TO_UPLOAD_IMAGE_SET_CURRENT",{uuid:o,base64Url:t})}});return l({},B(t))}}),Kt=e=>(ie("data-v-e37d67d6"),e=e(),le(),e),Qt={key:0,for:"uploader",class:"active-upload"},Zt={key:1,class:"tips active-upload"},ea=[Kt((()=>se("i",{class:"icon el-icon-upload active-upload"},null,-1))),Kt((()=>se("div",{class:"text active-upload"},"拖拽、粘贴、或点击此处上传",-1)))],ta=["src"];var aa=ye(Wt,[["render",function(e,t,a,n,s,o){const i=z("loading");return J((j(),F("div",{class:de(["upload-area active-upload",{focus:e.uploadAreaActive}]),onDragover:t[1]||(t[1]=Y((()=>{}),["prevent"])),onDrop:t[2]||(t[2]=Y(((...t)=>e.onDrop&&e.onDrop(...t)),["stop","prevent"])),onPaste:t[3]||(t[3]=(...t)=>e.onPaste&&e.onPaste(...t)),"element-loading-text":"图片上传中...","element-loading-background":"rgba(0, 0, 0, 0.5)"},[e.uploadAreaActive?(j(),F("label",Qt)):W("",!0),se("input",{id:"uploader",type:"file",onChange:t[0]||(t[0]=(...t)=>e.onSelect&&e.onSelect(...t)),multiple:"multiple"},null,32),e.toUploadImage.curImgBase64Url?W("",!0):(j(),F("div",Zt,ea)),e.toUploadImage.curImgBase64Url?(j(),F("img",{key:2,class:"active-upload",src:e.toUploadImage.curImgBase64Url,alt:"Pictures to be uploaded"},null,8,ta)):W("",!0)],34)),[[i,e.imageLoading]])}],["__scopeId","data-v-e37d67d6"]]);const na={class:"upload-page-container"},sa={key:0,class:"upload-page-left page-container",style:{width:"30%"}},oa={class:"row-item"},ia={class:"content-box"},la={class:"row-item"},ra={class:"content-box"},da={class:"row-item"},ua={class:"content-box",style:{"text-align":"right"}},ca=Z("重置 "),ga=Z("上传 ");var fa=ye(x({setup(e){const t=we(),a=P();te(null),te(null);const n=te(null),s=te(null),o=N((()=>t.getters.getUserConfigInfo)),i=N((()=>t.getters.getUserLoggingStatus)),l=N((()=>t.getters.getUploadedImageList)),r=N((()=>t.getters.getToUploadImage)),d=te(!1),u=()=>{const{token:e,selectedRepos:s,selectedDir:i}=o.value;return e?s?i?void(0!==r.value.list.length?r.value.list.length!==r.value.uploadedNumber?(d.value=!0,n.value.uploadImage_all(o.value).then((e=>{switch(e){case pt.uploaded:case pt.allUploaded:d.value=!1,t.dispatch("TO_UPLOAD_IMAGE_CLEAN_URL");break;case pt.uploadFail:d.value=!1,t.dispatch("TO_UPLOAD_IMAGE_LIST_FAIL")}})).catch((e=>{console.error("upload error: ",e),d.value=!1}))):T.error("请选择要上传的图片！"):T.error("图片不能为空！")):(T.error("目录不能为空！"),void a.push("/config")):(T.error("请选择一个仓库！"),void a.push("/config")):(T.error("请先完成图床配置！"),void a.push("/config"))},c=()=>{d.value=!1,t.dispatch("TO_UPLOAD_IMAGE_LOGOUT")};return V((()=>i),(e=>{!e&&c()})),(e,t)=>{const a=$("el-button");return j(),F("div",na,[oe(l).length?(j(),F("div",sa,[(j(!0),F(K,null,Q(oe(l),((e,t)=>(j(),F("div",{class:"uploaded-item",key:t},[H(rt,{"image-obj":e,"is-uploaded":!0},null,8,["image-obj"])])))),128))])):W("",!0),se("div",{class:"upload-page-right page-container",style:ce({width:oe(l).length?"70%":"100%"})},[se("div",oa,[se("div",ia,[H(aa,{"image-loading":d.value,ref:(e,t)=>{t.uploadAreaDom=e,s.value=e}},null,8,["image-loading"])])]),se("div",la,[se("div",ra,[H(Jt,{ref:(e,t)=>{t.toUploadImageCardDom=e,n.value=e},"loading-all-image":d.value},null,8,["loading-all-image"])])]),se("div",da,[se("div",ua,[oe(r).list.length?(j(),q(a,{key:0,plain:"",size:"small",onClick:c},{default:X((()=>[ca])),_:1})):W("",!0),H(a,{type:"primary",plain:"",size:"small",onClick:u},{default:X((()=>[ga])),_:1})])])],4)])}}}),[["__scopeId","data-v-7675cfde"]]);const pa={class:"page-container management-page-container"},ma={class:"content-container"},ha={class:"top"},Ia={class:"left"},_a={class:"right flex-start"},va=["onClick"],Ca=["onClick"],ba={class:"bottom","element-loading-text":"加载中...","element-loading-background":"rgba(0, 0, 0, 0.5)"},La={class:"image-list"};var Da=ye(x({setup(e){const t=we(),a=P(),n=N((()=>t.getters.getUserConfigInfo)),s=N((()=>t.getters.getUserLoggingStatus)),o=N((()=>t.getters.getDirImageList)),i=te([]),l=te(!1),r=te(!1);function d(e){return n.value.dirList.some((t=>t.value===e))}function u(e,t){return{uuid:dt(),dir:t,name:e.name,path:e.path,sha:e.sha,github_url:ht($e.gh,e,n.value),cdn_url:ht($e.cdn,e,n.value),md_gh_url:ht($e.md_gh,e,n.value),md_cdn_url:ht($e.md_cdn,e,n.value),deleting:!1,is_transform_md:!1,size:e.size}}function c(e){l.value=!0;const a={dir:e,imageList:[]};Me.get(`/repos/${n.value.owner}/${n.value.selectedRepos}/contents/${e}`).then((n=>{if(n&&200===n.status&&n.data.length>0){const s=[];for(const t of n.data)"file"===t.type&&gt(ut(t.name).suffix)&&s.push(u(t,e));a.imageList=s,t.dispatch("DIR_IMAGE_LIST_ADD_IMAGE_LIST",a),l.value=!1}}))}function g(e){const t=o.value.find((t=>t.dir===e));t&&t.imageList.length?i.value=t.imageList:c(e)}function f(){if(!o.value.length)return void Me.get(`/repos/${n.value.owner}/${n.value.selectedRepos}/contents`).then((e=>{if(console.log("[getReposContent] ",e),e&&200===e.status&&e.data.length>0){t.dispatch("DIR_IMAGE_LIST_ADD_DIR","/");for(const a of e.data)"dir"===a.type?t.dispatch("DIR_IMAGE_LIST_ADD_DIR",a.name):"file"===a.type&&gt(ut(a.name).suffix)&&t.dispatch("DIR_IMAGE_LIST_ADD_IMAGE",u(a,"/"));d(n.value.selectedDir)||(n.value.selectedDir="/"),g(n.value.selectedDir)}}));const{selectedDir:e}=n.value,a=o.value.find((t=>t.dir===e));a?a.imageList.length>0?i.value=a.imageList:c(e):d(e)&&c(e)}function p(){r.value=!r.value}function m(){t.dispatch("DIR_IMAGE_LOGOUT"),f()}return ne((()=>{f()})),V((()=>s),(e=>{!1===e.value&&a.push("/config")})),V((()=>o),(e=>{const t=e.value.find((e=>e.dir===n.value.selectedDir));t&&(i.value=t.imageList)}),{deep:!0}),(e,t)=>{const a=$("el-tooltip"),n=z("loading");return j(),F("div",pa,[se("div",ma,[se("div",ha,[se("div",Ia,[H(St,{onSelectedDirChange:g})]),se("div",_a,[H(a,{placement:"top",content:r.value?"切换方块展示":"切换列表展示"},{default:X((()=>[se("i",{class:de(["btn-icon",r.value?"el-icon-tickets":"el-icon-menu"]),onClick:Y(p,["stop"])},null,10,va)])),_:1},8,["content"]),H(a,{placement:"top",content:"重新加载图片"},{default:X((()=>[se("i",{class:"btn-icon el-icon-refresh",onClick:Y(m,["stop"])},null,8,Ca)])),_:1})])]),J(se("div",ba,[se("ul",La,[(j(!0),F(K,null,Q(i.value,((e,t)=>(j(),F("li",{class:"image-item",key:t,style:ce({width:r.value?"50%":"230px",height:r.value?"80px":"240px"})},[H(rt,{"image-obj":e,listing:r.value},null,8,["image-obj","listing"])],4)))),128))])],512),[[n,l.value]])])])}}}),[["__scopeId","data-v-1037b7bc"]]);const Ua={class:"tutorials-step-1"},Sa=Z(" 创建一个用来存储图片的 "),Aa=se("img",{src:"https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.j1486dtk68n.png",alt:"Create GitHub Repository"},null,-1),ka=x({setup(e){function t(){window.open("https://github.com/new")}return(e,a)=>(j(),F("div",Ua,[se("h3",null,[Sa,se("span",{class:"go-create-repo",onClick:t}," GitHub 仓库")]),Aa]))}});const Ea={class:"tutorials-step-2"},Oa=Z(" 创建一个有 repo 权限的 "),wa=se("img",{src:"https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.lpt1xl9fu.png",alt:"Create GitHub Token"},null,-1),Ma=se("p",null,"然后点击 Generate token 按钮，即可生成一个token，如下图：",-1),ya=se("img",{src:"https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.pzmcp6b80fk.png",alt:"token-demo"},null,-1),Ra=se("p",{style:{color:"red"}},[se("em",null,"新生成的 Token 只会显示一次，请妥善保存！如有遗失，重新生成即可。")],-1),Ta=x({setup(e){function t(){window.open("https://github.com/settings/tokens/new")}return(e,a)=>(j(),F("div",Ea,[se("h3",null,[Oa,se("span",{class:"go-create-token",onClick:t}," GitHub Token")]),wa,Ma,ya,Ra]))}});const xa={},Pa={class:"tutorials-step-3"},Ga=[ge('<h3>进行图床配置（绑定 GitHub Token、存储图片的仓库和目录）</h3><p>1、填写 Token，自动获取该用户下的仓库</p><img src="https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.4g8q5m7c8sq0.png"><br><p>2、在仓库的下拉列表中，选择一个作为图床的仓库</p><img src="https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.746g75olruk0.png"><br><p>3、选择一种目录方式（目录即仓库里存放图片的文件夹）</p><img src="https://cdn.jsdelivr.net/gh/XPoet/image-hosting@master/PicX/image.5ydmhgxjhgo0.png"><div class="dir-desc-box"><ul><li>新建目录：需手动输入一个新目录。</li><li>根目录：图片将直接存储在仓库根目录下。</li><li>自动目录：自动生成日期格式 YYYYMMDD 的目录。例如：20200909</li><li>选择仓库目录：自动获取仓库下所有目录，选择一个即可。</li></ul></div>',10)];const Na=x({name:"tutorials",components:{Step1:ka,Step2:Ta,Step3:ye(xa,[["render",function(e,t){return j(),F("div",Pa,Ga)}]])},setup(){const e=te(0);return{stepNum:e,step:t=>{"prev"===t&&(e.value<0?e.value=0:e.value-=1),"next"===t&&(e.value>3?e.value=3:e.value+=1)}}}}),Va=e=>(ie("data-v-0275023f"),e=e(),le(),e),Ba={class:"page-container tutorials-page-container"},$a={class:"step-content"},za={key:3},ja=[Va((()=>se("h2",null,"👍 恭喜你完成图床使用教程 🌟 快去试试吧~",-1))),Va((()=>se("h2",null,"https://github.com/XPoet/picx",-1)))],Fa={class:"btn-next-prev"},Ha=Z("上一步 "),Xa=Z("下一步 ");var Ya=ye(Na,[["render",function(e,t,a,n,s,o){const i=$("el-step"),l=$("el-steps"),r=$("Step1"),d=$("Step2"),u=$("Step3"),c=$("el-button");return j(),F("div",Ba,[H(l,{active:e.stepNum,"finish-status":"success","align-center":""},{default:X((()=>[H(i,{title:"创建 GitHub 仓库"}),H(i,{title:"获取 GitHub Token"}),H(i,{title:"配置图床"})])),_:1},8,["active"]),se("div",$a,[0===e.stepNum?(j(),q(r,{key:0})):W("",!0),1===e.stepNum?(j(),q(d,{key:1})):W("",!0),2===e.stepNum?(j(),q(u,{key:2})):W("",!0),3===e.stepNum?(j(),F("div",za,ja)):W("",!0)]),se("div",Fa,[e.stepNum>0?(j(),q(c,{key:0,type:"primary",onClick:t[0]||(t[0]=t=>e.step("prev"))},{default:X((()=>[Ha])),_:1})):W("",!0),e.stepNum<3?(j(),q(c,{key:1,type:"primary",onClick:t[1]||(t[1]=t=>e.step("next"))},{default:X((()=>[Xa])),_:1})):W("",!0)])])}],["__scopeId","data-v-0275023f"]]);const Ja={class:"page-container settings-page-container"},qa=(e=>(ie("data-v-e1f28488"),e=e(),le(),e))((()=>se("div",{class:"setting-title"},"个性设置：",-1))),Wa={class:"setting-list"},Ka={class:"setting-item"},Qa={class:"setting-item"};const Za=[{path:"/",name:"index",redirect:{name:"upload"}},{path:"/config",name:"config",component:je,meta:{title:"图床配置 | PicX 图床神器"}},{path:"/upload",name:"upload",component:fa,meta:{title:"图片上传 | PicX 图床神器"}},{path:"/management",name:"Management",component:Da,meta:{title:"图床管理 | PicX 图床神器"}},{path:"/tutorials",name:"tutorials",component:Ya,meta:{title:"使用教程 | PicX 图床神器"}},{path:"/about",name:"about",component:()=>Ie((()=>import("./about.7c684f70.js")),["assets/about.7c684f70.js","assets/about.06743d33.css","assets/vendor.919b8568.js","assets/vendor.08e5f4cf.css"]),meta:{title:"帮助反馈 | PicX 图床神器"}},{path:"/settings",name:"settings",component:ye(x({setup(e){const t=N((()=>Ee.getters.getUserConfigInfo)).value,a=()=>{Ee.dispatch("USER_CONFIG_INFO_PERSIST")};return(e,n)=>{const s=$("el-switch");return j(),F("div",Ja,[qa,se("ul",Wa,[se("li",Ka,[H(s,{modelValue:oe(t).personalSetting.defaultHash,"onUpdate:modelValue":n[0]||(n[0]=e=>oe(t).personalSetting.defaultHash=e),onChange:a,"active-text":"上传时默认给图片加上哈希码"},null,8,["modelValue"])]),se("li",Qa,[H(s,{modelValue:oe(t).personalSetting.defaultMarkdown,"onUpdate:modelValue":n[1]||(n[1]=e=>oe(t).personalSetting.defaultMarkdown=e),onChange:a,"active-text":"上传后默认开启 Markdown 格式的外链"},null,8,["modelValue"])])])])}}}),[["__scopeId","data-v-e1f28488"]]),meta:{title:"我的设置 | PicX 图床神器"}}],en=fe({history:pe(),routes:Za});en.beforeEach(((e,t,a)=>{e.meta.title&&(window.document.title=e.meta.title),a()}));const tn=x({name:"site-count",props:{isuv:{type:Boolean,default:!1}},setup(){const e=te(null);return ne((()=>{const t=document.createElement("script");t.async=!0,t.src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.value.appendChild(t)})),{siteCountDom:e}}}),an={class:"site-count",ref:"siteCountDom"},nn={key:0,id:"busuanzi_value_site_uv"},sn={key:1,id:"busuanzi_value_site_pv"};const on=x({name:"header-content",components:{siteCount:ye(tn,[["render",function(e,t,a,n,s,o){return j(),F("span",an,[e.isuv?(j(),F("span",nn)):W("",!0),e.isuv?W("",!0):(j(),F("span",sn))],512)}]])},setup(){const e=P(),t=we(),a=G({defaultUsername:"未登录",userConfigInfo:N((()=>t.state.userConfigInfoModule.userConfigInfo))});return r(l({},B(a)),{router:e,onUserInfoClick:()=>{a.userConfigInfo.loggingStatus||"/config"===e.currentRoute.value.path||e.push("/config")},handleCommand:a=>{switch(a){case"upload":e.push("/");break;case"config":e.push("/config");break;case"management":e.push("/management");break;case"logout":t.dispatch("LOGOUT"),e.push("/config")}},goGitHubRepo:()=>{window.open("https://github.com/XPoet/picx")}})}}),ln=e=>(ie("data-v-4d5395fa"),e=e(),le(),e),rn={class:"header"},dn={class:"header-left"},un=[ln((()=>se("div",{class:"logo"},[se("img",{src:"./assets/logo.206d082d.png",alt:"PicX"})],-1))),ln((()=>se("div",{class:"title"},"PicX",-1)))],cn={class:""},gn=Z(" 有 "),fn=Z(" 位小伙伴使用 PicX 图床神器 "),pn={class:"header-right"},mn={class:"username"},hn={key:0,class:"avatar"},In=[ln((()=>se("i",{class:"el-icon-user-solid"},null,-1)))],_n={class:"el-dropdown-link"},vn={class:"avatar"},Cn=["src","alt"],bn=Z(" 退出登录 ");var Ln=ye(on,[["render",function(e,t,a,n,s,o){var i,l;const r=$("site-count"),d=$("el-tooltip"),u=$("el-dropdown-item"),c=$("el-dropdown-menu"),g=$("el-dropdown");return j(),F("header",rn,[se("div",dn,[se("div",{class:"brand",onClick:t[0]||(t[0]=t=>e.router.push("/"))},un),se("div",{class:"website-count",onClick:t[1]||(t[1]=(...t)=>e.goGitHubRepo&&e.goGitHubRepo(...t))},[H(d,{content:"前往 GitHub 点 Star 支持一下作者(*￣︶￣)",placement:"bottom"},{default:X((()=>[se("i",cn,[gn,H(r,{isuv:!1}),fn])])),_:1})])]),se("div",pn,[se("div",{class:"user-info",onClick:t[2]||(t[2]=(...t)=>e.onUserInfoClick&&e.onUserInfoClick(...t))},[se("div",mn,ee(e.userConfigInfo.owner?e.userConfigInfo.owner:e.defaultUsername),1),(null==(i=e.userConfigInfo)?void 0:i.avatarUrl)?W("",!0):(j(),F("div",hn,In)),(null==(l=e.userConfigInfo)?void 0:l.avatarUrl)?(j(),q(g,{key:1,trigger:"click",onCommand:e.handleCommand},{dropdown:X((()=>[H(c,null,{default:X((()=>[H(u,{command:"logout"},{default:X((()=>[bn])),_:1})])),_:1})])),default:X((()=>{var t,a;return[se("span",_n,[se("span",vn,[se("img",{src:null==(t=e.userConfigInfo)?void 0:t.avatarUrl,alt:null==(a=e.userConfigInfo)?void 0:a.owner},null,8,Cn)])])]})),_:1},8,["onCommand"])):W("",!0)])])])}],["__scopeId","data-v-4d5395fa"]]);const Dn=x({name:"nav-content",setup(){const e=P(),t=we(),a=G({userConfigInfo:N((()=>t.getters.getUserConfigInfo)).value,navList:[{name:"图床配置",icon:"el-icon-edit-outline",isActive:!1,path:"/config"},{name:"上传图片",icon:"el-icon-upload2",isActive:!1,path:"/upload"},{name:"图床管理",icon:"el-icon-box",isActive:!1,path:"/management"},{name:"我的设置",icon:"el-icon-setting",isActive:!1,path:"/settings"},{name:"使用教程",icon:"el-icon-magic-stick",isActive:!1,path:"/tutorials"},{name:"帮助反馈",icon:"el-icon-chat-dot-round",isActive:!1,path:"/about"}],navClick(t){const{path:a}=t;if("/management"===a){if(""===this.userConfigInfo.selectedRepos)return T.warning("请选择一个仓库！"),void e.push("/config");if(""===this.userConfigInfo.selectedDir)return T.warning("目录不能为空！"),void e.push("/config")}e.push(a)}}),n=e=>{a.navList.forEach((t=>{const a=t;return a.isActive=t.path===e,a}))};return V((()=>e.currentRoute.value),(e=>{n(e.path)})),ne((()=>{e.isReady().then((()=>{n(e.currentRoute.value.path)}))})),l({},B(a))}}),Un={class:"nav"},Sn={class:"nav-list"},An=["onClick"],kn={class:"nav-content"},En={class:"nav-name"};const On={key:0,class:"image-box"},wn=["src"],Mn={key:0,class:"image-info"};const yn=x({name:"main-container",components:{headerContent:Ln,navContent:ye(Dn,[["render",function(e,t,a,n,s,o){return j(),F("aside",Un,[se("ul",Sn,[(j(!0),F(K,null,Q(e.navList,((t,a)=>J((j(),F("li",{class:de(["nav-item flex-center",{active:t.isActive}]),key:a,onClick:a=>e.navClick(t)},[se("div",kn,[se("i",{class:de(["nav-icon",t.icon])},null,2),se("span",En,ee(t.name),1)])],10,An)),[[re,"/management"!==t.path||e.userConfigInfo.loggingStatus]]))),128))])])}],["__scopeId","data-v-650dd07e"]]),imageViewer:ye(x({setup(e){const t=we(),a=N((()=>t.getters.getImageViewer));return(e,t)=>{var n,s,o,i;const l=$("el-tag");return j(),F("div",{class:de(["image-viewer",{active:oe(a).isShow}]),onClick:t[0]||(t[0]=e=>oe(a).isShow=!1)},[(null==(s=null==(n=oe(a))?void 0:n.imgInfo)?void 0:s.url)?(j(),F("div",On,[se("img",{class:"img",src:null==(i=null==(o=oe(a))?void 0:o.imgInfo)?void 0:i.url},null,8,wn),oe(a).imgInfo?(j(),F("div",Mn,[oe(a).imgInfo.name?(j(),q(l,{key:0,class:"item",size:"small"},{default:X((()=>[Z(" 图片名："+ee(oe(a).imgInfo.name),1)])),_:1})):W("",!0),oe(a).imgInfo.size?(j(),q(l,{key:1,class:"item",size:"small"},{default:X((()=>{return[Z(" 图片大小："+ee((e=oe(a).imgInfo.size,`${ft(e)} KB`)),1)];var e})),_:1})):W("",!0),oe(a).imgInfo.lastModified?(j(),q(l,{key:2,class:"item",size:"small"},{default:X((()=>{return[Z(" 最后修改时间："+ee((e=oe(a).imgInfo.lastModified,ke.formatTimestamp(e))),1)];var e})),_:1})):W("",!0)])):W("",!0)])):W("",!0)],2)}}}),[["__scopeId","data-v-c1944e44"]])},setup(){const e=we();return{changeUploadAreaActive:t=>{e.commit("CHANGE_UPLOAD_AREA_ACTIVE",t.target.classList.contains("active-upload"))}}}}),Rn={class:"top"},Tn={class:"bottom"},xn={class:"container"},Pn={class:"left"},Gn={class:"right"},Nn={class:"content"};var Vn=ye(x({name:"App",components:{mainContainer:ye(yn,[["render",function(e,t,a,n,s,o){const i=$("header-content"),l=$("nav-content"),r=$("router-view"),d=$("image-viewer");return j(),F(K,null,[se("main",{class:"main-container",onClick:t[0]||(t[0]=(...t)=>e.changeUploadAreaActive&&e.changeUploadAreaActive(...t))},[se("div",Rn,[H(i)]),se("div",Tn,[se("div",xn,[se("div",Pn,[H(l)]),se("div",Gn,[se("div",Nn,[H(r)])])])])]),H(d)],64)}],["__scopeId","data-v-7407492c"]])}}),[["render",function(e,t,a,n,s,o){const i=$("main-container");return j(),q(i)}]]);Ie((()=>import("./register-sw.74361854.js")),[]);const Bn=me(Vn);var $n;$n=Bn,[d,u,c,g,f,p,m,h,I,_,v,C,b,L,D,U,S,A,k,E,O,w].forEach((e=>{$n.use(e)})),Bn.use(en).use(Ee,Oe).mount("#app");export{ye as _};
